# 记账应用 - iOS智能记账软件设计文档

## 1. 项目概述

### 1.1 项目名称
记账应用 - 智能记账软件

### 1.2 项目目标
开发一款iOS原生记账应用，提供完整的记账功能，包括收入支出记录、分类管理、数据统计、资产管理等，帮助用户全面管理个人财务。

### 1.3 技术栈
- **开发语言**: Swift 5.0+
- **UI框架**: SwiftUI
- **数据存储**: Core Data + CloudKit
- **最低支持版本**: iOS 15.0+
- **目标设备**: iPhone, iPad

## 2. 功能需求分析

### 2.1 核心功能

#### 2.1.1 记账功能
- **快速记账**: 一键记账，支持收入/支出
- **分类管理**: 预设分类和自定义分类
- **日期选择**: 灵活选择记账日期
- **备注功能**: 添加详细备注信息
- **金额输入**: 支持小数点后两位

#### 2.1.2 数据统计
- **收支统计**: 月度/年度收支统计
- **分类分析**: 按分类统计支出情况
- **图表展示**: 饼图、柱状图、折线图
- **趋势分析**: 收支变化趋势

#### 2.1.3 资产管理
- **账户管理**: 现金、银行卡、投资账户
- **余额管理**: 账户余额调整
- **资产统计**: 总资产、净资产
- **资产详情**: 单个账户详细信息

#### 2.1.4 其他功能
- **数据同步**: iCloud自动同步
- **数据备份**: 本地和云端备份
- **设置管理**: 应用设置和偏好

### 2.2 功能模块

#### 2.2.1 主页模块
- 收支概览
- 快速记账按钮
- 最近记录列表
- 功能入口导航

#### 2.2.2 记账模块
- 记账弹窗
- 分类选择
- 金额输入
- 日期选择
- 备注输入

#### 2.2.3 统计模块
- 收支统计图表
- 分类分析
- 时间筛选
- 数据导出

#### 2.2.4 资产模块
- 资产管家入口
- 账户管理
- 余额调整
- 资产统计

## 3. 页面设计

### 3.1 主要页面结构

#### 3.1.1 记账主页
```
┌─────────────────────────────────┐
│ 状态栏                          │
├─────────────────────────────────┤
│ 导航栏                          │
│ [菜单] 记账应用 [设置]           │
├─────────────────────────────────┤
│ 本月收支概览                    │
│ 收入: ¥8,500  支出: ¥3,200     │
│ 结余: ¥5,300                   │
├─────────────────────────────────┤
│ 快速记账按钮                    │
│ [+ 记一笔]                     │
├─────────────────────────────────┤
│ 最近记录                        │
│ • 午餐 ¥25 餐饮 2024-01-15      │
│ • 交通 ¥8  交通 2024-01-15     │
│ • 购物 ¥120 购物 2024-01-14    │
├─────────────────────────────────┤
│ 功能导航                        │
│ [统计] [资产管家] [设置]         │
└─────────────────────────────────┘
```

#### 3.1.2 记账弹窗
```
┌─────────────────────────────────┐
│ 记一笔                    [×]   │
├─────────────────────────────────┤
│ 类型选择                        │
│ [支出] [收入]                   │
├─────────────────────────────────┤
│ 金额输入                        │
│ ¥__.__                          │
├─────────────────────────────────┤
│ 分类选择                        │
│ [餐饮 ▼]                        │
│ ┌─────────────────────────────┐ │
│ │ 餐饮                        │ │
│ │ 交通                        │ │
│ │ 购物                        │ │
│ │ 娱乐                        │ │
│ │ 医疗                        │ │
│ │ 教育                        │ │
│ │ 住房                        │ │
│ │ 其他                        │ │
│ └─────────────────────────────┘ │
├─────────────────────────────────┤
│ 日期选择                        │
│ 2024-01-15 [选择日期]           │
├─────────────────────────────────┤
│ 备注输入                        │
│ ________________                │
├─────────────────────────────────┤
│ [取消] [保存]                   │
└─────────────────────────────────┘
```

#### 3.1.3 分类选择页面
```
┌─────────────────────────────────┐
│ 选择分类                    [×]  │
├─────────────────────────────────┤
│ 支出分类                        │
│ ┌─────────────────────────────┐ │
│ │ 🍽️ 餐饮                    │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 🚗 交通                    │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 🛒 购物                    │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 🎮 娱乐                    │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 🏥 医疗                    │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 📚 教育                    │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 🏠 住房                    │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 📦 其他                    │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

#### 3.1.4 日期选择页面
```
┌─────────────────────────────────┐
│ 选择日期                    [×]  │
├─────────────────────────────────┤
│ 日历视图                        │
│ ┌─────────────────────────────┐ │
│ │    2024年1月                │ │
│ │ 日 一 二 三 四 五 六        │ │
│ │     1  2  3  4  5  6       │ │
│ │  7  8  9 10 11 12 13       │ │
│ │ 14 15 16 17 18 19 20       │ │
│ │ 21 22 23 24 25 26 27       │ │
│ │ 28 29 30 31                 │ │
│ └─────────────────────────────┘ │
├─────────────────────────────────┤
│ 快速选择                        │
│ [今天] [昨天] [本周] [本月]     │
├─────────────────────────────────┤
│ [取消] [确定]                   │
└─────────────────────────────────┘
```

#### 3.1.5 统计图表页面
```
┌─────────────────────────────────┐
│ 收支统计                    [×]  │
├─────────────────────────────────┤
│ 时间筛选                        │
│ [本月 ▼] [本年] [全部]          │
├─────────────────────────────────┤
│ 收支概览                        │
│ 收入: ¥8,500  支出: ¥3,200     │
│ 结余: ¥5,300                   │
├─────────────────────────────────┤
│ 支出分类统计                    │
│ ┌─────────────────────────────┐ │
│ │ 饼图展示                    │ │
│ │ 餐饮: 35%                   │ │
│ │ 交通: 20%                   │ │
│ │ 购物: 25%                   │ │
│ │ 其他: 20%                   │ │
│ └─────────────────────────────┘ │
├─────────────────────────────────┤
│ 收支趋势                        │
│ ┌─────────────────────────────┐ │
│ │ 折线图展示                  │ │
│ │ 日/周/月收支趋势            │ │
│ └─────────────────────────────┘ │
├─────────────────────────────────┤
│ 分类排行                        │
│ 1. 餐饮 ¥1,120                 │
│ 2. 购物 ¥800                   │
│ 3. 交通 ¥640                   │
│ 4. 其他 ¥640                   │
└─────────────────────────────────┘
```

#### 3.1.6 资产管家入口
```
┌─────────────────────────────────┐
│ 资产管家                    [×]  │
├─────────────────────────────────┤
│ 总资产概览                      │
│ 总资产: ¥125,680               │
│ 净资产: ¥98,420                │
├─────────────────────────────────┤
│ 账户列表                        │
│ ┌─────────────────────────────┐ │
│ │ 现金账户                    │ │
│ │ ¥2,500                     │ │
│ │ [详情]                     │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 招商银行储蓄卡              │ │
│ │ ¥15,680                    │ │
│ │ [详情]                     │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 投资账户                    │ │
│ │ ¥107,500                   │ │
│ │ [详情]                     │ │
│ └─────────────────────────────┘ │
├─────────────────────────────────┤
│ [+ 添加账户]                   │
└─────────────────────────────────┘
```

## 4. 数据结构设计

### 4.1 枚举定义

#### 4.1.1 记录类型枚举
```swift
enum RecordType: String, CaseIterable, Codable {
    case income = "income"
    case expense = "expense"
    
    var displayName: String {
        switch self {
        case .income:
            return "收入"
        case .expense:
            return "支出"
        }
    }
    
    var color: Color {
        switch self {
        case .income:
            return .green
        case .expense:
            return .red
        }
    }
}
```

#### 4.1.2 账户类型枚举
```swift
enum AccountType: String, CaseIterable, Codable {
    case cash = "cash"
    case bank = "bank"
    case investment = "investment"
    case other = "other"
    
    var displayName: String {
        switch self {
        case .cash:
            return "现金账户"
        case .bank:
            return "银行卡"
        case .investment:
            return "投资账户"
        case .other:
            return "其他账户"
        }
    }
    
    var icon: String {
        switch self {
        case .cash:
            return "banknote"
        case .bank:
            return "creditcard"
        case .investment:
            return "chart.line.uptrend.xyaxis"
        case .other:
            return "ellipsis.circle"
        }
    }
}
```

#### 4.1.3 交易类型枚举
```swift
enum TransactionType: String, CaseIterable, Codable {
    case income = "income"
    case expense = "expense"
    case transfer = "transfer"
    case adjustment = "adjustment"
    
    var displayName: String {
        switch self {
        case .income:
            return "收入"
        case .expense:
            return "支出"
        case .transfer:
            return "转账"
        case .adjustment:
            return "调整"
        }
    }
}
```

#### 4.1.4 分类类型枚举
```swift
enum CategoryType: String, CaseIterable, Codable {
    case food = "food"
    case transport = "transport"
    case shopping = "shopping"
    case entertainment = "entertainment"
    case medical = "medical"
    case education = "education"
    case housing = "housing"
    case other = "other"
    
    var displayName: String {
        switch self {
        case .food:
            return "餐饮"
        case .transport:
            return "交通"
        case .shopping:
            return "购物"
        case .entertainment:
            return "娱乐"
        case .medical:
            return "医疗"
        case .education:
            return "教育"
        case .housing:
            return "住房"
        case .other:
            return "其他"
        }
    }
    
    var icon: String {
        switch self {
        case .food:
            return "🍽️"
        case .transport:
            return "🚗"
        case .shopping:
            return "🛒"
        case .entertainment:
            return "🎮"
        case .medical:
            return "🏥"
        case .education:
            return "📚"
        case .housing:
            return "🏠"
        case .other:
            return "📦"
        }
    }
    
    var color: Color {
        switch self {
        case .food:
            return .orange
        case .transport:
            return .blue
        case .shopping:
            return .purple
        case .entertainment:
            return .pink
        case .medical:
            return .red
        case .education:
            return .green
        case .housing:
            return .brown
        case .other:
            return .gray
        }
    }
}
```

### 4.2 Core Data 模型

#### 4.2.1 Record (记账记录)
```swift
class Record: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var amount: Double
    @NSManaged var typeRawValue: String // 存储枚举的原始值
    @NSManaged var category: String
    @NSManaged var date: Date
    @NSManaged var note: String?
    @NSManaged var createdAt: Date
    @NSManaged var updatedAt: Date
    
    // 计算属性，将原始值转换为枚举
    var type: RecordType {
        get {
            return RecordType(rawValue: typeRawValue) ?? .expense
        }
        set {
            typeRawValue = newValue.rawValue
        }
    }
    
    // 关联关系
    @NSManaged var categoryEntity: Category?
}
```

#### 4.2.2 Category (分类)
```swift
class Category: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var name: String
    @NSManaged var icon: String
    @NSManaged var color: String
    @NSManaged var typeRawValue: String // 存储枚举的原始值
    @NSManaged var isDefault: Bool
    @NSManaged var sortOrder: Int32
    
    // 计算属性，将原始值转换为枚举
    var type: CategoryType {
        get {
            return CategoryType(rawValue: typeRawValue) ?? .other
        }
        set {
            typeRawValue = newValue.rawValue
        }
    }
    
    // 关联关系
    @NSManaged var records: Set<Record>?
}
```

#### 4.2.3 Account (账户)
```swift
class Account: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var name: String
    @NSManaged var typeRawValue: String // 存储枚举的原始值
    @NSManaged var balance: Double
    @NSManaged var currency: String
    @NSManaged var bankName: String?
    @NSManaged var cardNumber: String?
    @NSManaged var cardType: String? // "savings", "credit"
    @NSManaged var icon: String
    @NSManaged var color: String
    @NSManaged var isActive: Bool
    @NSManaged var note: String?
    @NSManaged var createdAt: Date
    @NSManaged var updatedAt: Date
    
    // 计算属性，将原始值转换为枚举
    var type: AccountType {
        get {
            return AccountType(rawValue: typeRawValue) ?? .other
        }
        set {
            typeRawValue = newValue.rawValue
        }
    }
    
    // 关联关系
    @NSManaged var transactions: Set<Transaction>?
}
```

#### 4.2.4 Transaction (交易记录)
```swift
class Transaction: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var amount: Double
    @NSManaged var typeRawValue: String // 存储枚举的原始值
    @NSManaged var category: String
    @NSManaged var accountId: UUID
    @NSManaged var targetAccountId: UUID?
    @NSManaged var date: Date
    @NSManaged var note: String?
    @NSManaged var createdAt: Date
    
    // 计算属性，将原始值转换为枚举
    var type: TransactionType {
        get {
            return TransactionType(rawValue: typeRawValue) ?? .expense
        }
        set {
            typeRawValue = newValue.rawValue
        }
    }
    
    // 关联关系
    @NSManaged var account: Account?
    @NSManaged var targetAccount: Account?
}
```

### 4.3 数据关系
```
Record (记账记录)
├── 关联 Category (分类)
└── 关联 Account (账户)

Category (分类)
└── 一对多 Record

Account (账户)
├── 一对多 Transaction (交易记录)
└── 一对多 Record (记账记录)

Transaction (交易记录)
├── 多对一 Account (源账户)
└── 多对一 Account (目标账户)
```

## 5. 技术架构设计

### 5.1 项目结构
```
ExpenseTracker/
├── App/
│   ├── ExpenseTrackerApp.swift
│   └── AppDelegate.swift
├── Views/
│   ├── Main/
│   │   ├── HomeView.swift
│   │   ├── StatisticsView.swift
│   │   ├── AssetManagerView.swift
│   │   └── SettingsView.swift
│   ├── Components/
│   │   ├── RecordCard.swift
│   │   ├── CategoryPicker.swift
│   │   ├── AmountInput.swift
│   │   ├── DatePicker.swift
│   │   ├── ChartView.swift
│   │   └── AccountCard.swift
│   └── Modals/
│       ├── AddRecordModal.swift
│       ├── CategoryPickerModal.swift
│       ├── DatePickerModal.swift
│       ├── AssetManagerModal.swift
│       └── SettingsModal.swift
├── Models/
│   ├── CoreData/
│   │   ├── ExpenseTracker.xcdatamodeld
│   │   ├── PersistenceController.swift
│   │   └── CloudKitManager.swift
│   ├── Enums/
│   │   ├── RecordType.swift
│   │   ├── AccountType.swift
│   │   ├── TransactionType.swift
│   │   └── CategoryType.swift
│   └── ViewModels/
│       ├── HomeViewModel.swift
│       ├── StatisticsViewModel.swift
│       ├── AssetManagerViewModel.swift
│       └── SettingsViewModel.swift
├── Services/
│   ├── RecordService.swift
│   ├── CategoryService.swift
│   ├── AccountService.swift
│   ├── StatisticsService.swift
│   ├── CloudKitService.swift
│   └── NotificationService.swift
├── Utils/
│   ├── Constants.swift
│   ├── Extensions.swift
│   ├── Formatters.swift
│   └── Validators.swift
└── Resources/
    ├── Assets.xcassets
    ├── Localizable.strings
    └── Info.plist
```

### 5.2 数据流架构
```
UI Layer (SwiftUI Views)
    ↓
ViewModel Layer (MVVM)
    ↓
Service Layer (Business Logic)
    ↓
Data Layer (Core Data + CloudKit)
```

## 6. UI/UX 设计规范

### 6.1 颜色方案
```swift
// 主色调
let primaryColor = Color("PrimaryColor") // #007AFF
let secondaryColor = Color("SecondaryColor") // #5856D6

// 功能色
let incomeColor = Color("IncomeColor") // #34C759
let expenseColor = Color("ExpenseColor") // #FF3B30
let neutralColor = Color("NeutralColor") // #8E8E93

// 背景色
let backgroundColor = Color("BackgroundColor") // #F2F2F7
let cardBackgroundColor = Color("CardBackgroundColor") // #FFFFFF

// 文字色
let primaryTextColor = Color("PrimaryTextColor") // #000000
let secondaryTextColor = Color("SecondaryTextColor") // #8E8E93
```

### 6.2 字体规范
```swift
// 标题字体
let titleFont = Font.system(size: 28, weight: .bold)
let subtitleFont = Font.system(size: 20, weight: .semibold)

// 正文字体
let bodyFont = Font.system(size: 16, weight: .regular)
let captionFont = Font.system(size: 14, weight: .medium)

// 数字字体
let amountFont = Font.system(size: 24, weight: .bold)
let balanceFont = Font.system(size: 32, weight: .bold)
```

### 6.3 间距规范
```swift
// 标准间距
let spacing: CGFloat = 16
let smallSpacing: CGFloat = 8
let largeSpacing: CGFloat = 24

// 圆角
let cornerRadius: CGFloat = 12
let smallCornerRadius: CGFloat = 8

// 卡片阴影
let cardShadow = Shadow(color: .black.opacity(0.1), radius: 8, x: 0, y: 2)
```

## 7. 开发计划

### 7.1 第一阶段 (MVP)
- [ ] 项目基础架构搭建
- [ ] Core Data 模型设计
- [ ] 枚举定义实现
- [ ] 主页UI实现
- [ ] 记账功能实现

### 7.2 第二阶段 (功能完善)
- [ ] 分类管理功能
- [ ] 统计图表功能
- [ ] 日期选择功能
- [ ] 资产管家功能

### 7.3 第三阶段 (高级功能)
- [ ] CloudKit 同步实现
- [ ] 数据导出功能
- [ ] 通知提醒功能
- [ ] 安全设置功能

### 7.4 第四阶段 (优化发布)
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 测试和调试
- [ ] App Store 发布准备

## 8. 风险评估

### 8.1 技术风险
- CloudKit 同步复杂性
- 大量数据性能优化
- 图表渲染性能

### 8.2 解决方案
- 采用成熟的同步策略
- 实现数据分页和缓存
- 优化图表渲染算法

## 9. 总结

本设计文档为记账应用提供了完整的技术方案，专注于记账功能，包括收入支出记录、分类管理、数据统计、资产管理等核心功能。项目采用现代化的iOS开发技术栈，使用枚举提高类型安全性，确保应用的稳定性、可扩展性和用户体验。

下一步将开始具体的代码实现，按照开发计划逐步完成各个功能模块。 