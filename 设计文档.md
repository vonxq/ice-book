# Ice Book - iOS记账应用设计文档

## 1. 项目概述

### 1.1 项目名称
Ice Book - 智能记账应用

### 1.2 项目目标
开发一款iOS原生记账应用，提供简洁易用的记账功能，支持iCloud数据同步，帮助用户更好地管理个人财务。

### 1.3 技术栈
- **开发语言**: Swift 5.0+
- **UI框架**: SwiftUI
- **数据存储**: Core Data + CloudKit
- **最低支持版本**: iOS 15.0+
- **目标设备**: iPhone, iPad

## 2. 功能需求分析

### 2.1 核心功能
1. **记账功能**
   - 收入/支出记录
   - 分类管理
   - 备注功能
   - 日期选择

2. **数据统计**
   - 月度/年度收支统计
   - 分类支出分析
   - 趋势图表展示

3. **账户管理**
   - 多账户支持
   - 账户余额管理
   - 转账记录

4. **预算管理**
   - 月度预算设置
   - 预算使用情况
   - 超支提醒

5. **数据同步**
   - iCloud自动同步
   - 多设备数据一致性

### 2.2 辅助功能
- 数据导出
- 备份恢复
- 主题切换
- 通知提醒

## 3. 页面设计

### 3.1 主要页面结构

#### 3.1.1 底部导航栏
```
┌─────────────────────────────────┐
│ 首页 │ 统计 │ 账户 │ 设置 │
└─────────────────────────────────┘
```

#### 3.1.2 首页 (HomeView)
```
┌─────────────────────────────────┐
│ 本月收支概览                    │
│ 收入: ¥5,000  支出: ¥3,200     │
│ 结余: ¥1,800                   │
├─────────────────────────────────┤
│ 快速记账按钮                    │
│ [+ 记一笔]                     │
├─────────────────────────────────┤
│ 最近记录                        │
│ • 午餐 ¥25 2024-01-15          │
│ • 交通 ¥8  2024-01-15          │
│ • 购物 ¥120 2024-01-14         │
└─────────────────────────────────┘
```

#### 3.1.3 统计页面 (StatisticsView)
```
┌─────────────────────────────────┐
│ 时间筛选 [本月 ▼]               │
├─────────────────────────────────┤
│ 收支统计                        │
│ 饼图展示                        │
├─────────────────────────────────┤
│ 分类排行                        │
│ 1. 餐饮 ¥800                   │
│ 2. 交通 ¥400                   │
│ 3. 购物 ¥300                   │
└─────────────────────────────────┘
```

#### 3.1.4 账户页面 (AccountView)
```
┌─────────────────────────────────┐
│ 账户列表                        │
│ 现金账户 ¥500                   │
│ 银行卡 ¥2,000                   │
│ 支付宝 ¥1,500                   │
├─────────────────────────────────┤
│ [+ 添加账户]                    │
└─────────────────────────────────┘
```

#### 3.1.5 设置页面 (SettingsView)
```
┌─────────────────────────────────┐
│ 个人设置                        │
│ 预算设置                        │
│ 分类管理                        │
│ 数据备份                        │
│ 主题设置                        │
│ 关于应用                        │
└─────────────────────────────────┘
```

### 3.2 弹窗页面

#### 3.2.1 记账弹窗 (AddRecordView)
```
┌─────────────────────────────────┐
│ 记一笔                    [×]   │
├─────────────────────────────────┤
│ 类型: [支出 ▼] [收入]           │
│ 金额: ¥__.__                   │
│ 分类: [餐饮 ▼]                  │
│ 账户: [现金 ▼]                  │
│ 日期: 2024-01-15               │
│ 备注: ________________          │
├─────────────────────────────────┤
│ [取消] [保存]                   │
└─────────────────────────────────┘
```

## 4. 数据结构设计

### 4.1 Core Data 模型

#### 4.1.1 Record (记账记录)
```swift
class Record: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var amount: Double
    @NSManaged var type: String // "income" | "expense"
    @NSManaged var category: String
    @NSManaged var account: String
    @NSManaged var date: Date
    @NSManaged var note: String?
    @NSManaged var createdAt: Date
    @NSManaged var updatedAt: Date
}
```

#### 4.1.2 Category (分类)
```swift
class Category: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var name: String
    @NSManaged var icon: String
    @NSManaged var color: String
    @NSManaged var type: String // "income" | "expense"
    @NSManaged var isDefault: Bool
    @NSManaged var sortOrder: Int32
}
```

#### 4.1.3 Account (账户)
```swift
class Account: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var name: String
    @NSManaged var balance: Double
    @NSManaged var icon: String
    @NSManaged var color: String
    @NSManaged var isActive: Bool
    @NSManaged var createdAt: Date
}
```

#### 4.1.4 Budget (预算)
```swift
class Budget: NSManagedObject {
    @NSManaged var id: UUID
    @NSManaged var amount: Double
    @NSManaged var spent: Double
    @NSManaged var month: String // "2024-01"
    @NSManaged var category: String?
    @NSManaged var isActive: Bool
    @NSManaged var createdAt: Date
}
```

### 4.2 数据关系
```
Record (记账记录)
├── 关联 Category (分类)
├── 关联 Account (账户)
└── 关联 Budget (预算)

Category (分类)
├── 一对多 Record
└── 一对多 Budget

Account (账户)
└── 一对多 Record

Budget (预算)
├── 关联 Category
└── 关联 Record (通过分类)
```

## 5. 技术架构设计

### 5.1 项目结构
```
IceBook/
├── App/
│   ├── IceBookApp.swift
│   └── AppDelegate.swift
├── Views/
│   ├── Main/
│   │   ├── HomeView.swift
│   │   ├── StatisticsView.swift
│   │   ├── AccountView.swift
│   │   └── SettingsView.swift
│   ├── Components/
│   │   ├── RecordCard.swift
│   │   ├── CategoryPicker.swift
│   │   ├── AmountInput.swift
│   │   └── ChartView.swift
│   └── Modals/
│       ├── AddRecordView.swift
│       ├── CategoryManagerView.swift
│       └── AccountManagerView.swift
├── Models/
│   ├── CoreData/
│   │   ├── IceBook.xcdatamodeld
│   │   ├── PersistenceController.swift
│   │   └── CloudKitManager.swift
│   └── ViewModels/
│       ├── RecordViewModel.swift
│       ├── StatisticsViewModel.swift
│       └── SettingsViewModel.swift
├── Services/
│   ├── DataService.swift
│   ├── CloudKitService.swift
│   └── NotificationService.swift
├── Utils/
│   ├── Constants.swift
│   ├── Extensions.swift
│   └── Helpers.swift
└── Resources/
    ├── Assets.xcassets
    ├── Localizable.strings
    └── Info.plist
```

### 5.2 数据流架构
```
UI Layer (SwiftUI Views)
    ↓
ViewModel Layer (MVVM)
    ↓
Service Layer (Business Logic)
    ↓
Data Layer (Core Data + CloudKit)
```

### 5.3 CloudKit 同步策略
1. **本地优先**: 所有操作先在本地执行
2. **增量同步**: 只同步变更的数据
3. **冲突解决**: 时间戳优先策略
4. **离线支持**: 离线时数据存储在本地

## 6. UI/UX 设计规范

### 6.1 颜色方案
```swift
// 主色调
let primaryColor = Color("PrimaryColor") // #007AFF
let secondaryColor = Color("SecondaryColor") // #5856D6

// 功能色
let incomeColor = Color("IncomeColor") // #34C759
let expenseColor = Color("ExpenseColor") // #FF3B30

// 背景色
let backgroundColor = Color("BackgroundColor") // #F2F2F7
let cardBackgroundColor = Color("CardBackgroundColor") // #FFFFFF

// 文字色
let primaryTextColor = Color("PrimaryTextColor") // #000000
let secondaryTextColor = Color("SecondaryTextColor") // #8E8E93
```

### 6.2 字体规范
```swift
// 标题字体
let titleFont = Font.system(size: 28, weight: .bold)
let subtitleFont = Font.system(size: 20, weight: .semibold)

// 正文字体
let bodyFont = Font.system(size: 16, weight: .regular)
let captionFont = Font.system(size: 14, weight: .medium)
```

### 6.3 间距规范
```swift
// 标准间距
let spacing: CGFloat = 16
let smallSpacing: CGFloat = 8
let largeSpacing: CGFloat = 24

// 圆角
let cornerRadius: CGFloat = 12
let smallCornerRadius: CGFloat = 8
```

## 7. 开发计划

### 7.1 第一阶段 (MVP)
- [ ] 项目基础架构搭建
- [ ] Core Data 模型设计
- [ ] 基础UI页面实现
- [ ] 记账功能实现
- [ ] 本地数据存储

### 7.2 第二阶段 (功能完善)
- [ ] 统计功能实现
- [ ] 账户管理功能
- [ ] 分类管理功能
- [ ] 预算功能实现

### 7.3 第三阶段 (高级功能)
- [ ] CloudKit 同步实现
- [ ] 数据导出功能
- [ ] 通知提醒功能
- [ ] 主题切换功能

### 7.4 第四阶段 (优化发布)
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 测试和调试
- [ ] App Store 发布准备

## 8. 风险评估

### 8.1 技术风险
- CloudKit 同步复杂性
- Core Data 性能优化
- 多设备数据一致性

### 8.2 解决方案
- 采用成熟的同步策略
- 实现数据分页加载
- 建立完善的错误处理机制

## 9. 总结

本设计文档为Ice Book记账应用提供了完整的技术方案，包括功能需求、页面设计、数据结构、技术架构等各个方面。项目采用现代化的iOS开发技术栈，确保应用的稳定性、可扩展性和用户体验。

下一步将开始具体的代码实现，按照开发计划逐步完成各个功能模块。 